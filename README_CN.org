#+TITLE: å¸®åŠ©æ–‡æ¡£

[[file:CHANGELOG.org][Changelog]]

* æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªç”¨æ¥å¤„ç†PDFæ–‡ä»¶çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå…¶ç›®æ ‡æ˜¯æ— ç¼åœ°å°†PDFé›†æˆåˆ°å„ç§ç¬”è®°å·¥ä½œæµä¸­ã€‚ç›®å‰ï¼Œè¯¥å·¥å…·æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

1. *ç®¡ç†ç›®å½•*â€‹ï¼šä»PDFå¯¼å‡ºç›®å½•åˆ°çº¯æ–‡æœ¬åˆ—è¡¨æ ¼å¼ï¼Œå¹¶åœ¨ä¿®æ”¹åå°†å…¶å¯¼å…¥å›PDFã€‚è¯¥æ ¼å¼ç”¨æˆ·æ˜“è¯»ï¼Œæ–¹ä¾¿ä¿®æ”¹ï¼Œå¯ä»¥åœ¨[[*ç›®å½•æ ¼å¼][æ­¤å¤„]]æŸ¥çœ‹ã€‚
2. *æ³¨é‡Šç®¡ç†*
   - *å¯¼å‡ºæ ¼å¼åŒ–çš„æ–‡æœ¬æ³¨é‡Š*ï¼šä»PDFä¸­æå–å¦‚é«˜äº®ã€æ–‡æœ¬ã€æ–¹æ¡†ç­‰ç±»å‹çš„æ³¨é‡Šï¼Œå­˜å‚¨ç›¸å…³çš„å›¾åƒï¼Œå¹¶æ”¯æŒä»è¿™äº›å›¾åƒä¸­OCRæå–æ–‡æœ¬ã€‚ä½¿ç”¨ [[https://pypi.org/project/Mako/][Mako]] æ¨¡æ¿ï¼Œæ‚¨å¯ä»¥è‡ªç”±å®šåˆ¶æ–‡æœ¬æ ¼å¼ï¼Œå¯¼å…¥åˆ°æ‚¨å–œæ¬¢çš„ç¬”è®°ç³»ç»Ÿä¸­ã€‚
   - *ç®¡ç†XFDFæ³¨é‡Š*ï¼šä»PDFä¸­å¯¼å‡ºXFDFæ³¨é‡Šå¹¶å°†å…¶å¯¼å…¥å›PDFã€‚è¯¥æ–‡ä»¶ä¸XChangeç­‰PDFé˜…è¯»å™¨å…¼å®¹ã€‚ç”±äºæŸäº›OCRè½¯ä»¶åœ¨OCRè¿‡ç¨‹ä¸­ä¼šå‹å¹³æ³¨é‡Šï¼Œå› æ­¤å¯ä»¥åœ¨OCRä¹‹å‰å¯¼å‡ºXFDFï¼Œç„¶ååœ¨OCRä¹‹åå¯¼å…¥XFDFä»¥ä¿ç•™å®Œæ•´çš„æ³¨é‡Šã€‚
   - *åˆ é™¤æ³¨é‡Š*ï¼šæ–¹ä¾¿åˆ†äº«åŸå§‹PDFã€‚
3. *é¡µé¢æ ‡ç­¾å’Œé¡µç çš„è½¬æ¢*ï¼šæœ‰æ—¶ç¬”è®°ä¸­è®°å½•çš„æ˜¯é¡µç ï¼Œä½†é˜…è¯»å™¨éœ€è¦åŸºäºé¡µé¢æ ‡ç­¾è¿›è¡Œå¯¼èˆªã€‚æ­¤åŠŸèƒ½å¤„ç†æ­¤ç±»å·®å¼‚ã€‚

* å¼€å§‹

#+begin_src bash
git clone --depth 1 https://github.com/yuchen-lea/pdfhelper.git
cd pdfhelper
make install
pip install -r requirements.txt
#+end_src

ç„¶åå¼€å§‹ä½¿ç”¨ =pdfhelper= å‘½ä»¤è¡Œå·¥å…·å§ï¼

å¯¹äºåç»­çš„æ›´æ–°ï¼Œåªéœ€ä»gitæ‹‰å–æœ€æ–°çš„ä»£ç å¹¶è¿è¡Œ=make update=ã€‚

* ä½¿ç”¨æ–¹æ³•

#+begin_src bash :results drawer
pdfhelper -h
#+end_src

#+RESULTS:
:results:
usage: pdfhelper [-h] [--version]
                 {export-toc,import-toc,delete-annot,export-xfdf-annot,import-xfdf-annot,export-annot,export-info,import-info,page-label-to-number,page-number-to-label}
                 ... INFILE

Some useful functions to process a PDF file.

positional arguments:
  {export-toc,import-toc,delete-annot,export-xfdf-annot,import-xfdf-annot,export-annot,export-info,import-info,page-label-to-number,page-number-to-label}
    export-toc          Export the TOC of the PDF.
    import-toc          Import TOC from a file into the PDF.
    delete-annot        Delete annotations from the PDF.
    export-xfdf-annot   Export XFDF annotations of the PDF.
    import-xfdf-annot   Import XFDF annotations of the PDF.
    export-annot        Export formatted text annotations of the PDF.
    export-info         Export information of the PDF.
    import-info         Import information of the PDF.
    page-label-to-number
                        Convert page label to page number.
    page-number-to-label
                        Convert page number to page label.
  INFILE                PDF file to process

options:
  -h, --help            show this help message and exit
  --version, -v         show program's version number and exit
:end:

** ç›®å½•æ ¼å¼

å®ä¾‹ï¼š
#+begin_example
@label 1=A
@label 8=[p-]II
@label 16=1
- Cover#1
- The Ten Commandments#2
- The Five Rules#3
- Contents#8
- Foreword#10
- Preface#12
# first = 16
- 1. Toys#2
- 2. Do It, Do It Again, and Again, and Again ...#14
- 3. Cons the Magnificent#32
# +2
- 4. Numbers Games#58
#+end_example

å…±æœ‰ä»¥ä¸‹å‡ ç§è®¾ç½®æ–¹å¼ï¼š

1. è®¾ç½®é¡µç : ä¸ºç¬¬3é¡µè®¾ç½®ç›®å½•â€œThe Five Rulesâ€
   #+begin_example
- The Five Rules#3
   #+end_example
   - ğŸ™‹â€ åˆ—è¡¨ç¼©è¿›å³ç›®å½•çš„ç¼©è¿›
2. è®¾ç½®èµ·å§‹é¡µ: ä¸ºç¬¬17é¡µè®¾ç½®ç›®å½•â€œ1. Toysâ€ ï¼ˆå› ä¸ºé¦–é¡µä»16å¼€å§‹ï¼Œæ‰€ä»¥2æŒ‡å‘ç‰©ç†ç¬¬17é¡µï¼‰
   #+begin_example
# 1 = 16
- 1. Toys#2
   #+end_example
   + ğŸ™‹â€æ³¨æ„ï¼šä½¿ç”¨æ¨¡å¼â€œ# number1=number2â€å¯ä»¥å°†PDFçš„ç‰©ç†é¡µé¢number2è§†ä¸ºnumber1ã€‚ä»»ä½•åç»­è®¾ç½®ä¸º'x'çš„é¡µé¢ç¼–å·å®é™…ä¸Šå°†æŒ‡å‘=x+number2-number1=çš„ç‰©ç†é¡µé¢ã€‚è¿™åŒæ ·å¯ä»¥è®¾ç½®ç¬¬äºŒå·çš„èµ·å§‹é¡µï¼Œä¾‹å¦‚â€œ# 250=5â€ã€‚
3. è®¾ç½®é¡µé¢ gap: ä¸ºç¬¬75é¡µï¼ˆ58 + (16-1) + 2ï¼‰è®¾ç½®ç›®å½•â€œ4. Numbers Gamesâ€
   #+begin_example
# +2
- 4. Numbers Games#58
   #+end_example
   + å½“æœ‰ç¼ºå¤±æˆ–é¢å¤–çš„é¡µé¢æ—¶å¾ˆæœ‰ç”¨ã€‚åœ¨ç¼ºå¤±é¡µé¢çš„ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œè®¡å…¥é¡µç çš„ç©ºç™½é¡µå·²è¢«åˆ é™¤ï¼‰ï¼Œè®¾ç½®â€œ# -[ç¼ºå¤±çš„é¡µé¢æ•°]â€ã€‚åœ¨é¢å¤–é¡µé¢çš„ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œæ’å›¾é¡µé¢æœªè®¡å…¥é¡µç ï¼‰ï¼Œè®¾ç½®â€œ# +[æ·»åŠ çš„é¡µé¢æ•°]â€ã€‚
4. è®¾ç½®labelï¼š
   - ä»ç¬¬1é¡µå¼€å§‹ï¼Œé¡µç æ ·å¼ä¸ºå¤§å†™å­—æ¯ï¼Œç¬¬1é¡µçš„é¡µç ä¼šæ˜¾ç¤ºä¸º "A"ï¼Œç¬¬2é¡µä¸º "B"ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°ç¬¬7é¡µã€‚
   - ä»ç¬¬8é¡µå¼€å§‹ï¼Œé¡µç æ ·å¼åˆ‡æ¢ä¸ºå¸¦æœ‰å‰ç¼€ "p-" çš„å¤§å†™ç½—é©¬æ•°å­—ã€‚ç¬¬8é¡µçš„é¡µç ä¼šæ˜¾ç¤ºä¸º "p-II"ï¼Œç¬¬9é¡µä¸º "p-III"ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°ç¬¬15é¡µã€‚
   - ä»ç¬¬16é¡µå¼€å§‹ï¼Œç¬¬16é¡µçš„é¡µç ä¼šæ˜¾ç¤ºä¸º "1"ï¼Œç¬¬17é¡µä¸º "2"ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°æ–‡æ¡£ç»“æŸã€‚

** å¯¼å‡ºæ³¨é‡Š

ç›®å‰ï¼Œæ”¯æŒä»¥ä¸‹æ³¨é‡Šç±»å‹ï¼š

| Type             | Result                                                            |
|------------------+-------------------------------------------------------------------|
| ä¾¿ç­¾ Text        | comment                                                           |
| æ–‡æœ¬ FreeText    | comment                                                           |
| æ–¹æ¡† Square      | comment + picture (set the zoom factor by ~--image-zoom~) + text (extract from the PDF, or use the ~--ocr-service~ and ~--ocr-language~ to recognize text within images.) |
| é«˜äº® Highlight   | comment + text (extract from the PDF)                             |
| ä¸‹åˆ’çº¿ Underline | comment + text (extract from the PDF)                             |
| æ³¢æµªçº¿ Squiggly  | comment + text (extract from the PDF)                             |
| åˆ é™¤çº¿ StrikeOut | comment + text (extract from the PDF)                             |
| æ‰‹å†™ Ink         | comment + picture (ä¿å­˜æ–‡æ¡£ä¸­æ ‡è®°é«˜åº¦å†…çš„å†…å®¹ï¼Œè€Œä¸ä»…ä»…æ˜¯æ ‡è®°æœ¬èº«ã€‚ set the zoom factor by ~--image-zoom~) + text (extract from the PDF, or use the ~--ocr-service~ and ~--ocr-language~ to recognize text within images.) |
| çº¿æ¡/ç®­å¤´ Line   | comment + picture (ä¿å­˜æ–‡æ¡£ä¸­æ ‡è®°é«˜åº¦å†…çš„å†…å®¹ï¼Œè€Œä¸ä»…ä»…æ˜¯æ ‡è®°æœ¬èº«ã€‚ set the zoom factor by ~--image-zoom~) + text (extract from the PDF, or use the ~--ocr-service~ and ~--ocr-language~ to recognize text within images.) |

You can customize the note format by
- ~--with-toc~
- ~--toc-list-item-format~
- ~--annot-list-item-format~

*** Template æ”¯æŒçš„å˜é‡

ä½¿ç”¨æ–¹æ³•å‚è€ƒ file:format_annots_template.py

| å˜é‡         | è¯´æ˜                              | toc-list-item | annot-list-item |
|--------------+-----------------------------------+---------------+-----------------|
| level        | å±‚çº§                              | âœ“            | âœ“              |
| page         | é¡µç                               | âœ“            | âœ“              |
| content      | ç›®å½•æ–‡æœ¬                          | âœ“            | âœ—              |
| pdf_path     | PDFæ–‡ä»¶è·¯å¾„                       | âœ“            | âœ“              |
| bib_key      | å‚è€ƒæ–‡çŒ®key                       | âœ“            | âœ“              |
| type         | ç¬”è®°ç±»å‹                          | âœ—            | âœ“              |
| text         | annotçš„è‡ªèº«æ–‡æœ¬                   | âœ—            | âœ“              |
| comment      | annotçš„æ³¨é‡Šæ–‡æœ¬                   | âœ—            | âœ“              |
| annot_number | annotç¼–å·ï¼Œä»1é€’å¢                | âœ—            | âœ“              |
| annot_id     | annotåœ¨PDFä¸­çš„ID                  | âœ—            | âœ“              |
| height       | annotåœ¨é¡µé¢çš„ä½ç½®ï¼ˆ0-1ï¼‰          | âœ—            | âœ“              |
| color        | annoté¢œè‰²çš„hex codeï¼Œä¾‹å¦‚ #e44234 | âœ—            | âœ“              |
| pic_path     | annotçš„å›¾ç‰‡è·¯å¾„                   | âœ—            | âœ“              |

* Credits

æ­¤é¡¹ç›®å—åˆ°ä»¥ä¸‹å·¥å…·çš„å¯å‘ï¼š

- [[https://github.com/0xabu/pdfannots][0xabu/pdfannots: Extracts and formats text annotations from a PDF file]]: based on pdfminer and format as markdown text. It deals with hyphens but donot extract rectangle annot.
- [[https://www.cnblogs.com/pdfpatcher/archive/2011/04/12/2013974.html][PDFPatcher]](Chinese) a great pdf utility tool.
